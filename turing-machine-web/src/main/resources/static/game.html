<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图灵一号游戏机</title>
</head>
<body onkeypress="keyPress(0)">
<style>
    * {
        padding: 0px;
        margin: 0px;
    }

    .title {
        margin-top: 40px;
        font-size: 3rem;
        color: green;
    }

    .cells {
        margin-top: 60px;
    }

    .cells .cell {
        background-color: green;
        color: white;
        font-size: 5rem;
        width: 100px;
        height: 100px;
        display: inline-block;
        line-height: 100px;
     }
     .usage {
        margin-top: 50px;
        font-size: 2rem;
        text-align: center;
     }


</style>

<div style="text-align:center;">

    <div class="title">图灵一号游戏机</div>

    <pre class="usage">
        使用说明：手指滑动或方向键：🔼加一，🔽减一，◀️向左移动，▶️向右移动，最小0
    </pre>

    <div class="cells">
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
        <span class="cell">0</span>
    </div>
</div>

<script>
    function init() {
        document.onkeyup = dealKeyCode;
        renderCell(0, SELECTED_COLOR);
    }

    function keyPress() {
        dealKeyCode();
    }

    function getPressChar() {
        return String.fromCharCode(event.which);
    }
    function changeNumber(index, number) {
       var cells = document.getElementsByClassName("cell");
       var newNumber = cells[index].innerText - (-number);
       cells[index].innerText = newNumber <=0 ? 0 : newNumber;
    }

    const SELECTED_COLOR = "#a7680b";
    const COMMON_COLOR = "green";

    var currentIndex = 0;
    function dealKeyCode() {
        var keycode = event.which||event.keyCode;
        console.log(keycode);
        switch(keycode){
        case 38: //up
          changeNumber(currentIndex, 1);
          break;
        case 40: //down
          changeNumber(currentIndex, -1);
          break;
        case 37: //left
          moveLeft();
          break;
        case 39: //right
          moveRight()
          break;
        case 13: //enter
          break;
        case 27: //esc
        case 32: //space
            break;
        }
        console.log(currentIndex);

    }

    function moveLeft() {

        renderCell(currentIndex,COMMON_COLOR );
        currentIndex =  currentIndex<=0 ? 0 : currentIndex-1;
        renderCell(currentIndex,SELECTED_COLOR );
    }

    function moveRight() {

        renderCell(currentIndex,COMMON_COLOR );
        currentIndex =  currentIndex>=7 ? 7 : currentIndex+1;
        renderCell(currentIndex,SELECTED_COLOR );
    }

    function renderCell(index, color) {
        var cells = document.getElementsByClassName("cell");
        cells[index].style.backgroundColor = color;
    }

    document.addEventListener('touchstart',touch, false);
    document.addEventListener('touchmove',touch, false);
    document.addEventListener('touchend',touch, false);

    var clientX_start,clientX_end,clientY_start,clientY_end;

    function touch (event){
        var event = event || window.event;
        switch(event.type){
            case "touchstart":
                clientX_start=event.touches[0].clientX;
                clientY_start=event.touches[0].clientY;
                break;
            case "touchend":
                callbackTouchEnd();
                break;
            case "touchmove":
                //event.preventDefault();
                clientX_end = event.changedTouches[0].clientX;
                clientY_end = event.changedTouches[0].clientY;
                break;
        }
    }
    function callbackTouchEnd() {
       console.log("clientX_start,clientX_end,clientY_start,clientY_end", clientX_start,clientX_end,clientY_start,clientY_end)

       if (Math.abs(clientX_start-clientX_end) > 3 * Math.abs(clientY_start-clientY_end)) {//左右滑动
            if (clientX_start>clientX_end+50) { //向左
                moveLeft();
            } else if (clientX_start < clientX_end-50) { //向右
               moveRight();
            }
       } else if ( Math.abs(clientX_start-clientX_end) * 3 < Math.abs(clientY_start-clientY_end) ) {//上下滑动
            if (clientY_start>clientY_end+50) { //向上
                changeNumber(currentIndex, 1);
            } else if (clientY_start < clientY_end-50) { //向下
                changeNumber(currentIndex, -1);
            }
       }
    }
    init();


</script>
</body>
</html>